<div class="form-container">
    <h2>Add New Train</h2>
    <form [formGroup]="trainForm" (ngSubmit)="onSubmit()">

        <div class="form-row">
            <div class="form-group">
                <label for="trainName">Train Name</label>
                <input id="trainName" type="text" formControlName="trainName" placeholder="e.g., Express One">
                <div *ngIf="trainForm.get('trainName')?.invalid && trainForm.get('trainName')?.touched"
                    class="error-message">
                    Train name is required.
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="source">Source</label>
                <input id="source" type="text" formControlName="source" placeholder="e.g., Mumbai">
                <div *ngIf="trainForm.get('source')?.invalid && trainForm.get('source')?.touched" class="error-message">
                    Source is required.
                </div>
            </div>
            <div class="form-group">
                <label for="destination">Destination</label>
                <input id="destination" type="text" formControlName="destination" placeholder="e.g., Delhi">
                <div *ngIf="trainForm.get('destination')?.invalid && trainForm.get('destination')?.touched"
                    class="error-message">
                    Destination is required.
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="departureTime">Departure Time</label>
                <input id="departureTime" type="time" formControlName="departureTime">
                <div *ngIf="trainForm.get('departureTime')?.invalid && trainForm.get('departureTime')?.touched"
                    class="error-message">
                    Departure time is required.
                </div>
            </div>
            <div class="form-group">
                <label for="arrivalTime">Arrival Time</label>
                <input id="arrivalTime" type="time" formControlName="arrivalTime">
                <div *ngIf="trainForm.get('arrivalTime')?.invalid && trainForm.get('arrivalTime')?.touched"
                    class="error-message">
                    Arrival time is required.
                </div>
                <div *ngIf="trainForm.errors?.['arrivalTimeBeforeDeparture'] && (trainForm.get('arrivalTime')?.touched || trainForm.get('departureTime')?.touched)"
                    class="error-message">
                    Arrival time must be after departure time.
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="status">Status</label>
            <select id="status" formControlName="status">
                <option *ngFor="let status of trainStatus" [value]="status">{{ status }}</option>
            </select>
        </div>

        <div class="form-group">
            <label>Schedule Days</label>
            <div class="checkbox-group">
                <div *ngFor="let day of daysOfWeek" class="checkbox-item">
                    <input type="checkbox" [value]="day" (change)="onCheckboxChange($event)">
                    <label>{{ day }}</label>
                </div>
            </div>
            <div *ngIf="trainForm.get('scheduleDays')?.invalid && trainForm.get('scheduleDays')?.touched"
                class="error-message">
                At least one schedule day is required.
            </div>
        </div>

        <div formArrayName="fareTypes">
            <h4>Fare Types</h4>
            <div *ngFor="let fareGroup of fareTypes.controls; let i=index" [formGroupName]="i" class="fare-type-group">
                <div class="form-row">
                    <div class="form-group">
                        <label>Class Type</label>
                        <select formControlName="classType">
                            <option *ngFor="let type of classTypes" [value]="type">{{ type }}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Price</label>
                        <input type="number" formControlName="price" placeholder="e.g., 500">
                        <div *ngIf="fareTypes.controls[i].get('price')?.invalid && fareTypes.controls[i].get('price')?.touched"
                            class="error-message">
                            Price must be a positive number.
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Seats Available</label>
                        <input type="number" formControlName="seatsAvailable" placeholder="e.g., 100">
                        <div *ngIf="fareTypes.controls[i].get('seatsAvailable')?.invalid && fareTypes.controls[i].get('seatsAvailable')?.touched"
                            class="error-message">
                            Seats must be a positive number.
                        </div>
                    </div>
                </div>
                <button type="button" class="remove-btn" (click)="removeFareType(i)"
                    *ngIf="fareTypes.length > 1">Remove</button>
            </div>
            <button type="button" class="add-btn" (click)="addFareType()">Add Fare Type</button>
        </div>

        <div class="form-actions">
            <button type="submit" class="submit-btn" [disabled]="trainForm.invalid">Add Train</button>
            <button type="button" class="cancel-btn" routerLink="/admin/trains">Cancel</button>
        </div>

    </form>
</div>